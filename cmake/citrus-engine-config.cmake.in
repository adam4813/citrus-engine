@PACKAGE_INIT@

include(CMakeFindDependencyMacro)

# Expose installed assets directory for consumers
set(CITRUS_ENGINE_ASSETS_INSTALL_DIR "${PACKAGE_PREFIX_DIR}/share/citrus-engine/assets")

# Disable C++ extensions to ensure portability for GNU and Clang
set(CMAKE_CXX_EXTENSIONS OFF)

# Find required dependencies that the engine needs
find_dependency(Angelscript CONFIG)
find_dependency(Bullet CONFIG REQUIRED)
find_dependency(glfw3 CONFIG)
find_dependency(glm CONFIG)
find_dependency(flecs CONFIG)
find_dependency(Jolt CONFIG REQUIRED)
find_dependency(spdlog CONFIG)
find_dependency(nlohmann_json CONFIG)
find_dependency(imgui CONFIG)
find_dependency(unofficial-lua CONFIG)

if(NOT EMSCRIPTEN)
    find_dependency(glad CONFIG)
endif()

# Include the appropriate exported targets based on platform
if(EMSCRIPTEN)
    # Look for WASM-specific targets
    if(EXISTS "${CMAKE_CURRENT_LIST_DIR}/citrus-engine-targets-wasm.cmake")
        include("${CMAKE_CURRENT_LIST_DIR}/citrus-engine-targets-wasm.cmake")
    else()
        # Fallback to generic targets
        include("${CMAKE_CURRENT_LIST_DIR}/citrus-engine-targets.cmake")
    endif()
else()
    # Look for native-specific targets
    if(EXISTS "${CMAKE_CURRENT_LIST_DIR}/citrus-engine-targets-native.cmake")
        include("${CMAKE_CURRENT_LIST_DIR}/citrus-engine-targets-native.cmake")
    else()
        # Fallback to generic targets
        include("${CMAKE_CURRENT_LIST_DIR}/citrus-engine-targets.cmake")
    endif()
endif()

# Helper function to setup asset copying (the only custom functionality needed)
function(setup_asset_preload target_name assets_dir)
    if(EMSCRIPTEN)
        # Preload assets for WASM
        target_link_options(${target_name} PRIVATE
            --preload-file ${assets_dir}@/assets
        )

        # Copy assets for WASM build
        add_custom_command(TARGET ${target_name} PRE_LINK
            COMMAND ${CMAKE_COMMAND} -E copy_directory
            ${assets_dir}
            ${CMAKE_CURRENT_BINARY_DIR}/assets
            COMMENT "Copying assets for WASM build"
            VERBATIM
        )
    else()
        # Copy assets to build directory for native builds
        add_custom_command(TARGET ${target_name} POST_BUILD
            COMMAND ${CMAKE_COMMAND} -E copy_directory
            ${assets_dir}
            $<TARGET_FILE_DIR:${target_name}>/assets
            COMMENT "Copying assets to build directory"
        )
    endif()
endfunction()

check_required_components(citrus-engine)
