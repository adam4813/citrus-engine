@PACKAGE_INIT@

include(CMakeFindDependencyMacro)

# Disable C++ extensions to ensure portability for GNU and Clang
set(CMAKE_CXX_EXTENSIONS OFF)

# Find required dependencies that the engine needs
find_dependency(glfw3)
find_dependency(glm)
find_dependency(flecs)
find_dependency(spdlog)
find_dependency(nlohmann_json)
find_dependency(imgui)
find_dependency(glad)

# Include the appropriate exported targets based on platform
if(EMSCRIPTEN)
    # Look for WASM-specific targets
    if(EXISTS "${CMAKE_CURRENT_LIST_DIR}/game-engine-targets-wasm.cmake")
        include("${CMAKE_CURRENT_LIST_DIR}/game-engine-targets-wasm.cmake")
    else()
        # Fallback to generic targets
        include("${CMAKE_CURRENT_LIST_DIR}/game-engine-targets.cmake")
    endif()
else()
    # Look for native-specific targets
    if(EXISTS "${CMAKE_CURRENT_LIST_DIR}/game-engine-targets-native.cmake")
        include("${CMAKE_CURRENT_LIST_DIR}/game-engine-targets-native.cmake")
    else()
        # Fallback to generic targets
        include("${CMAKE_CURRENT_LIST_DIR}/game-engine-targets.cmake")
    endif()
endif()

# Helper function to setup asset copying (the only custom functionality needed)
function(setup_asset_preload target_name assets_dir)
    if(EMSCRIPTEN)
        # Preload assets for WASM
        target_link_options(${target_name} PRIVATE
            --preload-file ${assets_dir}@/assets
        )

        # Copy assets for WASM build
        add_custom_command(TARGET ${target_name} PRE_LINK
            COMMAND ${CMAKE_COMMAND} -E copy_directory
            ${assets_dir}
            ${CMAKE_CURRENT_BINARY_DIR}/assets
            COMMENT "Copying assets for WASM build"
            VERBATIM
        )
    else()
        # Copy assets to build directory for native builds
        add_custom_command(TARGET ${target_name} POST_BUILD
            COMMAND ${CMAKE_COMMAND} -E copy_directory
            ${assets_dir}
            $<TARGET_FILE_DIR:${target_name}>/assets
            COMMENT "Copying assets to build directory"
        )
    endif()
endfunction()

check_required_components(game-engine)
